<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
  <link rel="stylesheet" href="css/index.css">

  <title>Duel Page</title>

</head>
<body>
<form id="logoutForm" action="/logout" method="post" style="position: fixed; top: 20px; right: 20px;">
  <button type="submit" id="logoutBtn" onclick="return confirm('Вы уверены, что хотите выйти?')">Выйти из аккаунта</button>
</form>

<h1>Duel Game</h1>

<label for="roomId">Введите номер комнаты:</label>
<input type="text" id="roomId" placeholder="123">
<button id="duelBtn">Начать дуэль</button>
<button id="campaignBtn" style="margin-top: 15px;">Начать кампанию</button>
<!-- Новая кнопка выбора персонажа -->
<button id="selectCharacterBtn" style="margin-top: 15px;">Выбрать персонажа</button>
<p id="status"></p>

<script>
  const duelBtn = document.getElementById('duelBtn');
  const campaignBtn = document.getElementById('campaignBtn');
  const selectCharacterBtn = document.getElementById('selectCharacterBtn'); // новая кнопка

  const status = document.getElementById('status');

  // --- Дуэль ---
  duelBtn.addEventListener('click', async () => {
    const roomId = document.getElementById('roomId').value.trim();
    if (!roomId) {
      status.textContent = 'Введите номер комнаты!';
      return;
    }

    try {
      const response = await fetch(`/StartDuel`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({ gameCode: roomId })
      });

      if (!response.ok) throw new Error('Ошибка при запуске дуэли');

      window.location.href = `/gameplay.html?gameCode=${encodeURIComponent(roomId)}`;
    } catch (e) {
      status.textContent = 'Ошибка: ' + e.message;
    }
  });

  // --- Кампания ---
  campaignBtn.addEventListener('click', async () => {
    try {
      const response = await fetch(`/campaign/startCampaign`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
      });

      if (!response.ok) throw new Error('Ошибка при запуске кампании');

      const text = await response.text();
      // вытаскиваем имя врага из ответа: "Бой начат против: Turk Warrior"
      const enemyName = text.match(/против: (.+)$/)[1];

      // редирект на страницу кампании
      window.location.href = `/campaign.html?enemyName=${encodeURIComponent(enemyName)}`;
    } catch (e) {
      status.textContent = 'Ошибка: ' + e.message;
    }
  });
  // --- Новая кнопка "Выбрать персонажа" ---
  selectCharacterBtn.addEventListener('click', () => {
    window.location.href = "character-selection.html"; // путь к твоей странице выбора
  });
</script>

</body>
</html>
